# 削峰填谷 {#concept_pzw_hgm_lgb .concept}

对于突然到来的大量请求，您可以配置流控规则，以稳定的速度逐步处理这些请求，起到“削峰填谷”的效果，从而避免流量突刺造成系统负载过高。

## 场景 {#section_vkt_n3m_lgb .section}

请求的到来，往往是没有规律的。

例如，某应用的处理能力是每秒 10 个请求。在某一秒，突然到来了 30 个请求，而接下来两秒，都没有请求到达。在这种情况下，如果直接拒绝 20 个请求，应用在接下来的两秒就会空闲。所以，需要把请求突刺均摊到一段时间内，让系统负载保持在请求处理水位之内，同时尽可能地处理更多请求，从而起到“削峰填谷”的效果。

![](https://aliware-images.oss-cn-hangzhou.aliyuncs.com/ahas/dg_peak_filling.png)

上图中，红色的部分代表超出消息处理能力的部分。观察得出，消息突刺往往都是瞬时的、不规律的，其后一段时间系统往往都会有空闲资源。把红色的那部分消息平摊到后面空闲时去处理，这样既可以保证系统负载处在一个稳定的水位，又可以尽可能地处理更多消息。通过配置流控规则，可以达到消息匀速处理的效果。

## 原理 {#section_ftz_djm_lgb .section}

Sentinel 专门为这种场景提供了匀速器的特性，可以把突然到来的大量请求以匀速的形式均摊，以固定的间隔时间让请求通过，以稳定的速度逐步处理这些请求，起到“削峰填谷”的效果，从而避免流量突刺造成系统负载过高。

同时，堆积的请求将会排队，逐步进行处理；当请求的预计排队时间超过最大超时时长时，则直接拒绝这部分请求，而不是拒绝全部请求。

例如，配置匀速模式下请求 QPS 为 5，则每 200 ms 处理一条请求，多余的处理任务将排队；同时设置了超时时间为 5 s，则预计排队时长超过 5 s 的处理任务将被直接拒绝。

示意图如下：

![](https://aliware-images.oss-cn-hangzhou.aliyuncs.com/ahas/dg_waiting_example.png)

## 配置流控规则 {#section_el4_2tm_lgb .section}

在 AHAS 控制台上，为目标应用资源配置流控规则（示例如下）。

![](https://aliware-images.oss-cn-hangzhou.aliyuncs.com/ahas/db_example_flowcontrol.png)

**说明：** 具体操作步骤，参见[新建流控规则](intl.zh-CN/流控降级/控制台指南/流控规则.md#section_yks_qfd_kgb)。

