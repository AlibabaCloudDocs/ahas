# 实时监控应用数据 {#concept_mzv_z2d_kgb .concept}

为应用接入流控降级服务后，您可以监控应用和资源 API 维度的实时数据（细化至秒级），从而评估系统的整体表现，并未流控降级规则的配置提供重要依据。具体监控指标包括 QPS、响应时间、流控降级接口数等。

**说明：** 请务必在 AHAS 控制台左上角选择应用接入的**地域**，否则无法获取应用数据。

## 应用概览 {#section_yps_jx5_vfb .section}

在 [AHAS 控制台](https://ahas.console.aliyun.com/)，单击左侧导航栏的**流控降级**，进入**流控降级**页面。所有已接入流控降级服务的应用以卡片形式展示。

**您可以进行以下操作：**：

-   单击应用名称前面的星星图标，可收藏该应用，并靠前显示。
-   单击某个应用卡片，可进入该应用的**监控详情**界面。

![](https://aliware-images.oss-cn-hangzhou.aliyuncs.com/ahas/pg_safeguarding.png)

应用卡片上的具体信息说明如下表：

|信息项|说明|
|---|--|
|系统规则数|该应用配置的系统保护规则个数|
|流控接口数|配置了流控规则的接口数|
|降级接口数|配置了降级规则的接口数|
|机器数|运行该应用的机器数|
|通过QPS|当前时间（秒级）内通过的 QPS （Queries per second）|
|拒绝QPS|当前时间（秒级）被拦截的 QPS （Queries per second）|

## 监控详情 {#section_w23_kdh_4fb .section}

单击流控降级页面的某个应用卡片，进入该应用的监控详情页面。您可以查看当前应用中的所有资源的数据分布、历史水位对比情况。

**说明：** 在**监控详情**页面左上角的**应用名称**下拉列表中，选择目标应用，可快捷切换应用。

-   **机器分布级别说明** 

    根据正态分布的三西格玛定律，认为集群中所有机器的 QPS、RT 值都分布在正负三个标准差范围内。通常认为：

    -   处于（-1σ，1σ）区间内的机器是安全的。
    -   处于（-2σ，-1σ）和（1σ，2σ）区间内的机器是需要注意的。
    -   处于（-3σ，-2σ）和（2σ，3σ）区间内的机器是有问题的。
    示意图如下：

    ![](images/44319_zh-CN.png "三西格玛原理示意")

    基于上述数据分布原理，根据 QPS、RT 指标值的分布情况，将机器分为安全、警告和危险三个级别，并展示当前资源在所有机器上的 QPS、RT 的最大、最小值。如下图所示：

    ![](images/44321_zh-CN_source.png "API 接口资源监控图")

-   **查看单机监控详情** 

    处于警告和危险级别的机器是需要重点关注的。点击该机器的 IP 可以查看单机的秒级监控曲线图，方便快速定位问题。

    ![](images/44322_zh-CN.png "单机监控详情")

    曲线图说明如下：

    -   三条曲线分别表示过去 5 分钟内该资源上通过的 QPS 、被拦截的 QPS 和平均响应时间。
    -   鼠标悬停在趋势图上可以查看某一时刻的数据。
    -   单击下方的图例，可选择在曲线图中不显示某条曲线。
-   **查看历史监控详情** 

    监控详情页面左上角的水位球，展示了过去 6 小时安全水位的最大值。如果当前值超过最大值时，水位球会变为红色，此时，您应该为该资源配置流控降级规则。

    ![](images/44329_zh-CN.png "危险水位图")

-   **新建流控降级规则** 

    单击水位图下方的**规则**，可以快速创建或查看流控降级规则。具体操作，参见[流控规则](intl.zh-CN/流控降级/控制台指南/流控规则.md#)和[降级规则](intl.zh-CN/流控降级/控制台指南/降级规则.md#)。

    **说明：** 应用中可能存在多个资源，配置的流控和降级规则最终都会作用到具体的资源上。

-   **收藏常用的资源** 

    单击资源名称前面的星星图标，可收藏该资源，并靠前显示。


## 请求链路 {#section_rfw_hly_fgb .section}

**请求链路**页面会展示某个应用在单台机器（实例）上的所有资源以及实时的调用数据。共有两种视图：

-   平铺视图：不区分调用链路关系，平铺展示资源的运行情况。
-   树状视图：根据资源的调用链路关系，展示树状结构。

**说明：** 只有当应用中的资源有访问量时，才会显示在**请求链路**页面。

在右上角选择目标机器 IP 地址，可快捷切换机器。

![](https://aliware-images.oss-cn-hangzhou.aliyuncs.com/ahas/sc_request_links.png)

**可选操作**：

-   新增流控或降级规则：单击资源**操作**栏中的流控或降级，可以快速创建流控和降级规则。具体操作，参见[流控规则](intl.zh-CN/流控降级/控制台指南/流控规则.md#)和[降级规则](intl.zh-CN/流控降级/控制台指南/降级规则.md#)。

    **说明：** 在**请求链路**页面新建的流控或降级规则，在全局生效。

-   查看历史监控详情：单击资源**操作**栏中的监控图标，可根据需要定位过去任意 30 分钟内的资源表现，包括通过的 QPS 和被拦截的 QPS。

    ![](https://aliware-images.oss-cn-hangzhou.aliyuncs.com/ahas/db_monitordetails.png)


## 查看机器列表 {#section_vz1_g22_ggb .section}

**机器列表**页面会展示您的某个应用接入 AHAS 流控降级服务的所有实例。当一段时间没有向 AHAS 控制台发送心跳时，此实例会自动被标记为**失联**状态。

**说明：** 在页面左上角的**应用名称**下拉列表中，选择目标应用，可快捷切换应用。

![](https://aliware-images.oss-cn-hangzhou.aliyuncs.com/ahas/page_instance_list.png)

## 查看操作日志 {#section_kg4_nty_3hb .section}

**操作日志**页面将记录您对某个应用进行的操作，包括具体资源名、操作的内容、操作时间和操作人 ID 等，方便您追踪应用和资源的变更。

**说明：** 在页面左上角的应用名称下拉列表中，选择目标应用，可快捷切换应用。

