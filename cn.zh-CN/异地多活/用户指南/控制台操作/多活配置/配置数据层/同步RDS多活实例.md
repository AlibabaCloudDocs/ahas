# 同步RDS多活实例

配置数据层后可以实现中心单元与普通单元数据库的强一致性。同步RDS多活实例包括Copy和Unit两种同步类型，您可以在不同场景下建立单向或者双向同步链路。

-   在两个单元环境中分别已创建一个或多个同名RDS。
-   已在对应源RDS实例和目标RDS实例之间建立好同步链路，且同步链路状态已达到同步中。

## 步骤一：创建多活属性

1.  登录[MSHA控制台](https://msha.console.aliyun.com)。

2.  在控制台左侧导航栏选择**配置** \> **异地数据层配置**。

3.  在异地数据层配置页面选择**RDS**，并单击列表右侧的**配置多活属性**。

    ![RDS配置](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/5428716951/p86264.png)

4.  在**添加多活属性**面板中进行以下配置：

    1.  选择**同步实例类型**。

        -   **Copy**：由中心单元向普通单元单向同步。
        -   **Unit**：中心单元和普通单元双向同步。
        -   **Mix**：按数据表粒度选择进行中心单元和普通单元的双向同步。选择的多活表在切流时做多活逻辑处理，非多活表跳过多活逻辑处理。
    2.  在**多活实例配置**区域单击**添加**，并添加源RDS实例、源RDS库、目标RDS实例和目标RDS库。

    3.  选择**同步延迟策略**。

        同步延迟策略在执行切流时生效。

        -   **同步延迟时，跳过延迟禁写策略**：多活实例组建立的同步链路在切流时的同步位点时间没有追赶上切流配置生效时间，不禁止对该实例分组下的写操作SQL语句。
        -   **同步延迟时，禁止写策略**：多活实例组建立的同步链路在切流时的同步位点时间没有追赶上切流配置生效时间，禁止对该实例分组下的写操作SQL语句。
        -   **同步延迟时，禁止更新策略**：多活实例组建立的同步链路在切流时的同步位点时间没有追赶上切流配置生效时间，禁止对该实例分组下的更新操作SQL语句。
    4.  单击**确定**

    添加成功后，**RDS多活实例分组**区域未配置实例数将增加1。本示例以Copy类型为例。

    ![RDS result ](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/5428716951/p86272.png)

    -   **未配置实例**：Copy、Unit多活实例分组没有配置同步链路的数量。
    -   **同步中实例**：Copy多活实例分组正向同步链路同步状态为同步中的数量，Unit多活实例分组正向同步链路和反向同步链路同步状态为同步中的数量。
    -   **异常中实例**：Copy多活实例分组正向同步链路同步状态不为同步中的数量，Unit多活实例分组正向同步链路和反向同步链路同步状态不为同步中的数量。

## 步骤二：创建RDS同步链路

1.  单击**创建同步链路**。

    ![RDS同步链路](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/5428716951/p102323.png)

2.  在**创建同步链路**页面进行以下配置。

    1.  选择**同步类型**。

        **说明：** 若选择Copy同步实例类型，则同步类型仅可选择单向链路；若选择Unit同步实例类型，则同步类型仅可选择双向链路。

    2.  选择**同步链路规格**。

        -   micro最高同步性能200 records/s。
        -   small最高同步性能2000 records/s。
        -   medium最高同步性能5000 records/s。
        -   large无限制。
        详情请参见[数据同步链路规格说明](/cn.zh-CN/产品简介/规格说明/数据同步链路规格说明.md)。

    3.  选择添加**源RDS实例库**和**目标RDS实例库**。

    4.  单击**下一步**。

3.  在**选择同步对象**页面进行以下配置。

    1.  在**源库对象**列表中选中需同步的数据表并单击**\>**。

    2.  选择**全量数据初始化规则**，默认选中**正向**。

    3.  选择**冲突修复策略**。

        -   **Ignore**：遇到冲突时，使用目标实例中的冲突记录。
        -   **Overwrite**：遇到冲突时，覆盖目标实例中的冲突记录。
        -   **TaskFailed**：遇到冲突时，任务报错退出。
    4.  单击**创建**。

4.  在**链路预览**页面检查该RDS同步信息，然后单击**创建**。


## 步骤三：配置同步链路

在目标实例右侧**操作**栏单击**配置**。

**说明：** 若同步类型为双向同步，则需先配置正向链路（中心单元到普通单元的链路），需等待正向链路的同步状态为同步中时才可配置反向链路（普通单元到中心单元的链路）。

配置后，**RDS多活实例分组**区域同步中实例数将增加1。同步链路将显示在数据层配置页面，且同步状态为**同步中**。

![RDS](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/5428716951/p87980.png)

