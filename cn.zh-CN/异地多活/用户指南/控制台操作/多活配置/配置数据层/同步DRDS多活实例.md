# 同步DRDS多活实例

配置数据层后可以实现中心单元与普通单元数据库的强一致性。同步DRDS多活实例包括Copy和Unit、Mix三种同步类型，您可以在不同场景下建立单向或者双向同步链路。

分别在两个单元创建同名的DRDS库（且一个DRDS实例下只允许创建一个实例库），并在分别两个单元的DRDS实例库下创建表名完全一致的表，目前支持分库分表、分库单表、单库分库、单库单表四种表类型的同步。

## 步骤一：配置DRDS多活属性

1.  登录[MSHA控制台](https://msha.console.aliyun.com)。

2.  在控制台左侧导航栏选择**配置** \> **异地数据层配置**。

3.  在数据层配置页面选择**DRDS**，并单击列表右侧的**配置多活属性**。

    ![配置数据层](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/8937911061/p169282.png)

4.  在配置多活属性面板中进行以下配置：

    1.  选择**同步实例类型**。

        -   **Copy**：由中心单元向普通单元单向同步。
        -   **Unit**：中心单元和普通单元双向同步。
        -   **Mix**：按数据表粒度选择进行中心单元和普通单元的双向同步。选择的多活表在切流时做多活逻辑处理，非多活表跳过多活逻辑处理。
    2.  在**多活实例配置**区域单击**添加**，并添加源DRDS实例、源DRDS库、目标DRDS实例和目标DRDS库。

    3.  选择**同步延迟策略**。

        同步延迟策略在执行切流时生效。

        -   **同步延迟时，跳过延迟禁写策略**：多活实例组建立的同步链路在切流时的同步位点时间没有追赶上切流配置生效时间，不禁止对该实例分组下的写操作SQL语句。
        -   **同步延迟时，禁止写策略**：多活实例组建立的同步链路在切流时的同步位点时间没有追赶上切流配置生效时间，禁止对该实例分组下的写操作SQL语句。
        -   **同步延迟时，禁止更新策略**：多活实例组建立的同步链路在切流时的同步位点时间没有追赶上切流配置生效时间，禁止对该实例分组下的更新操作SQL语句。
    4.  单击**确定**。

    添加成功后，**DRDS多活实例分组**区域未配置实例数将增加1。本示例以Copy类型为例。

    ![DRDS1](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/4428716951/p86090.png)

    -   **未配置实例**：Copy、Unit、Mix多活实例分组没有配置同步链路的数量。
    -   **同步中实例**：Copy多活实例分组正向同步链路同步状态为同步中的数量，Unit、Mix多活实例分组正向同步链路和反向同步链路同步状态为同步中的数量。
    -   **异常中实例**：Copy多活实例分组正向同步链路同步状态不为同步中的数量，Unit、Mix多活实例分组正向同步链路和反向同步链路同步状态不为同步中的数量。

## 步骤二：创建DRDS同步链路

1.  单击右上角的**创建同步链路**。

2.  在**创建同步链路**的**填写基本信息**页面进行以下配置。

    1.  选择**同步类型**。

        **说明：** 若选择Copy同步实例类型，则同步类型仅可选择单向链路；若选择Unit或Mix同步实例类型，则同步类型仅可选择双向链路。

    2.  选择**同步链路规格**。

        -   micro最高同步性能200 records/s。
        -   small最高同步性能2000 records/s。
        -   medium最高同步性能5000 records/s。
        -   large无限制。
        详情请参见[数据同步链路规格说明](/cn.zh-CN/产品简介/规格说明/数据同步链路规格说明.md)。

    3.  选择添加**源DRDS实例库**和**目标DRDS实例库**。

    4.  单击**下一步**。

3.  在**选择同步对象**页面进行以下配置。

    1.  在**源库对象**列表中选中需同步的数据表并单击**\>**。

    2.  选择**全量数据初始化规则**，默认选中**正向**。

    3.  选择**冲突修复策略**。

        -   **Ignore**：遇到冲突时，使用目标实例中的冲突记录。
        -   **Overwrite**：遇到冲突时，覆盖目标实例中的冲突记录。
        -   **TaskFailed**：遇到冲突时，任务报错退出。
    4.  单击**创建**。

4.  在**链路预览**页面检查该DRDS实例中的RDS同步信息，然后单击**创建**。


## 步骤三：配置同步链路

在目标实例右侧**操作**栏单击**配置**。

**说明：** 若同步类型为双向同步，则需先配置正向链路（中心单元到普通单元的链路），需等待正向链路的同步状态为同步中时才可配置反向链路（普通单元到中心单元的链路）。

配置后，将进入预检查页面。预检查成功后，**DRDS多活实例分组**区域同步中实例数将增加1。同步链路将显示在数据层配置页面，且同步状态为**同步中**。

![result](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/4428716951/p86092.png)

-   单击**操作**栏的**详情**查看该DRDS实例中的RDS同步信息。
-   若无需使用该同步链路，可单击**操作**栏的**释放**，在弹出的对话框中，单击**确认**。

